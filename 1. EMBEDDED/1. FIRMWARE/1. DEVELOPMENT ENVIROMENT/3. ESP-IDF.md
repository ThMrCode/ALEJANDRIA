ESP-IDF es el `SDK` oficial de la familia de ESPRESSIF. El Sistema de Construcción que utiliza es CMake, y su programa maestro es `idf.py`, los comandos principales son:

```
idf.py
	create-project
	create-component -C components <my-component>
	build
	flash
	menuconfig
	monitor
	set-target esp32
	fullclean
```

La estructura de proyecto es modular, se trabaja por componentes. Al crear un proyecto se crea por defecto el componente main, es el principal, los demás irán bajo la carpeta components. Proyectos y Componentes deben ser creados mediante los comandos respectivos, una vez creados su estructura interna puede variar, siempre que se resuelvan las dependencias en el CMakeLists.

La estructura de un proyecto es:

```
my_project/
├── .vscode/                    <- (opcional, para el ruteo del Intellisence)
├── build/                      <- Archivos de Compilación
│
├── main/                       
│   ├── main.c                  <- Punto de entrada de la aplicación
│   └── CMakeLists.txt          <- Resolucion de Dependencias del Componente
│
├── components/                 
│   └── my_component/
│       └── include/            <- Headers Files
│           └── my_component.h
│       └── src/                <- Source Files
│           └── my_component.h
│       └── CMakeLists.txt      <- Resolucion de Dependencias del Componente
│
├── CMakeLists.txt              <- CMake principal del proyecto
├── partitions.cvs              <- Partitions File
├── sdkconfig                   <- Config (menuconfig)
├── sdkconfig.old               <- Backup (menuconfig)
│
```

El `sdkconfig` se altera mediante cli (menuconfig), pudiendo cambiar el tamaño de flash, macros config del framework oficial, y customizar las particiones. 

La estructura del `partitions.cvs` 

```
# Name,       Type, SubType, Offset,   Size
nvs,          data, nvs,     0x9000,   0x6000
phy_init,     data, phy,     0xf000,   0x1000
factory,      app,  factory, 0x10000,  0x3F0000
```

Un componente es completamente portable, y engloba todo dentro de su carpeta, durante compilación se reduce a un solo binario libComponent.a, el `SDK` lo reconoce por ser una subcarpeta de components con un CMakeLists, y haber sido ruteado por su creación con el comando oficial.

Los archivos CMake de cada componente se modifican manualmente
El archivo Cmake del componente sera el responsable de la generacion de su .a, en el se deben resolver las dependencias entre mis componentes tanto entre los generados manualmente como los que use del espidf o del registro, (exepto los fundamentales, los fundamentales como freeRTOS se incluyen por defecto), todo esto con require

Si se desea que las dependencias a un componente se resuelvan de manera automatica por espidf, este componente debe ser agregado como dependencia, aprender a crear dependencias
idf.py
	add-dependency

los archivos kconfig son el puente entre las configuracion CONFIGURACION_X del menuconfig y las macros CONFIG_CONFIGURACION_X del codigo

idf.py create-component -C components mi_componente



---
### COMPONENTS
Todo el firmware de esp-idf se trabaja por componentes, un componente es una carpeta con código y archivos de configuración, lo que define al componente es tener el archivo CMakeLists.txt en dicha carpeta, así es como esp-idf lo reconoce como componente, además sigue determinado formato:

```
│   └── my_component/
│       ├── CMakeLists.txt
│       ├── Kconfig         ← Opcional, para configuración desde menuconfig
│       ├── include/        ← Headers públicos (*.h)
│       │   └── my_component.h
│       ├── src/            ← Archivos fuente (*.c / *.cpp)
│       │   └── my_component.c
│       └── component.yml   ← Opcional, usado con el "IDF Component Manager"
```

La estructura de los archivos C/C++ y Headers puede variar, pero se suele seguir el uso de carpetas include y src, lo importante es indicar su ubicación en el CMakeLists

```
idf_component_register(
  SRCS src
  INCLUDE_DIRS "include"
  REQUIRES other_component
)
```

Las dependencias que requiera nuestro componente se resuelve escribiendo el nombre de su carpeta en `REQUIRES`, el `idf.py` busca dicha carpeta en 3 lugares posibles

```
│       ├── Componentes del Framework, en la carpeta components del esp-idf
			ruta default C:\Espressif\frameworks\esp-idf-v5.4.1\components
			
│       ├── Componentes del Proyecto, en la carpeta components del proyecto
			ruta my-project-path\components
			
│       ├── Componentes agregados como dependencias con component.yml y 
			add-dependency, son descargados a la carpeta .dependencies por el
			comando add-dependency, ahi es donde los busca esp-idf, a su vez 
			si alguna de nuestras dependencias requiere otra, se agrega 
			tambien como otra carpeta en \.dependencies
			ruta my-project\.dependencies
```

El archivo `component.yml` permite especificar las dependencias del componente, sobre todo las dependencias externas, así al meter `idf.py reconfigure` el `idf.py` podrá leer todos los `component.yml` y asegurarse de que las dependencias especificadas en component.yml estén o bien en el framework, o el en proyecto o en `\.dependencies`, y si no están, las descarga a `\.dependencies`

El archivo `KConfig` es independiente, es solo tenerlo agregado o no, ya que cada que corramos `menuconfig`, `idf.py`, se encargara de buscarlo en cada componente incluido en el proyecto, sea de los del framework, los locales, o los de dependencies, se definen opciones que en si, activan o desactivan macros del mismo nombre, o le dan valor.

Para inspeccionar el grafo de dependencias del proyecto

```
idf.py build --graph build/graph.dot
dot -Tpng build/graph.dot -o deps.png
```


Para añadir intellisence, hacer el c_cpp_properties.json


Para salir del monitor es Crl + t + Crtl + x